# 模块

## 登录模块

1. 发送邮件

   Spring Email

2. 注册功能

3. 会话管理

4. 验证码

   Kaptcha

5. 登录、退出功能

6. 显示登录信息

   定义拦截器，实现HandlerInterceptor

   配置拦截器，为它指定拦截、排除的路径

   - 在请求开始时查询登录用户
   - 在本次请求中持有用户数据
   - 在模板视图上显示用户数据
   - 在请求结束时清理用户数据

7. 账号设置

8. 检测登录状态

## 核心模块

1. 过滤敏感词

   字典树

2. 发布帖子

3. 帖子详情

4. 事务管理

   ![image-20200703152929829](\img\image-20200703152929829.png)

5. 显示评论

6. 添加评论

7. 私信列表

8. 发送私信

9. 统一异常处理

   - @ControllerAdvice
     - 用于修饰类，表示该类是Controller的全局配置类。
     - 在此类中，可以对Controller进行如下三种全局配置：
       异常处理方案、绑定数据方案、绑定参数方案。
   - @ExceptionHandler
     - 用于修饰方法，该方法会在Controller出现异常后被调用，用于处理捕获到的异常。
   - @ModelAttribute
     - 用于修饰方法，该方法会在Controller方法执行前被调用，用于为Model对象绑定参数。
   - @DataBinder
     - 用于修饰方法，该方法会在Controller方法执行前被调用，用于绑定参数的转换器。

10. 统一记录日志

## Redis优化

- 使用Redis存储验证码
  - 验证码需要频繁的访问与刷新，对性能要求较高。
  - 验证码不需永久保存，通常在很短的时间后就会失效。
  - 分布式部署时，存在Session共享的问题。
- 使用Redis存储登录凭证
  - 处理每次请求时，都要查询用户的登录凭证，访问的频率非常高。
- 使用Redis缓存用户信息
  - 处理每次请求时，都要根据凭证查询用户信息，访问的频率非常高。

## 异步消息队列

1. 发送系统通知
   - 触发事件
     - 评论后，发布通知
     - 点赞后，发布通知
     - 关注后，发布通知
   - 处理事件
     - 封装事件对象
     - 开发事件的生产者
     - 开发事件的消费者
2. 显示系统通知
   - 通知列表
     - 显示评论、点赞、关注三种类型的通知
   - 通知详情
     - 分页显示某一类主题所包含的通知
   - 未读消息
     - 在页面头部显示所有的未读消息数量

## 分布式搜索引擎

1. 搜索服务
   - 将帖子保存至Elasticsearch服务器。
   - 从Elasticsearch服务器删除帖子。
   - 从Elasticsearch服务器搜索帖子。
2. 发布事件
  - 发布帖子时，将帖子异步的提交到Elasticsearch服务器。
  - 增加评论时，将帖子异步的提交到Elasticsearch服务器。
  - 在消费组件中增加一个方法，消费帖子发布事件。
3. 显示结果
  - 在控制器中处理搜索请求，在HTML上显示搜索结果。

## 权限控制

Spring Security